import java.awt.Color;
import java.awt.Dimension;
import java.awt.Graphics;
import java.awt.Graphics2D;
import java.awt.geom.Rectangle2D;
import java.util.ArrayList;

import javax.swing.JOptionPane;
import javax.swing.JPanel;


public class CentipedeComponent extends JPanel implements Runnable {
	
	private final int BLOCK_SIZE = 25;
	private final int WINDOW_SIZE = 900;
	private final Color NORMAL_MUSHROOM_COLOR = Color.GREEN;
	private final Color POISONED_MUSHROOM_COLOR = Color.MAGENTA;
	private final Color HERO_COLOR = Color.BLUE;
	private ArrayList<Mushroom> mushrooms;
//	private ArrayList<Weapon> weapons;
//	private ArrayList<Enemy> enemies;
	private Character hero;
	private CentipedeListener gameListener;
	
	public CentipedeComponent(){
		this.setPreferredSize(new Dimension(WINDOW_SIZE, WINDOW_SIZE));
		String levelToLoad = JOptionPane.showInputDialog("What level do you"
				+ " want to load? (input 99 for a test level)");
//		this.hero = new Character();
		this.mushrooms = new ArrayList<Mushroom>();
		this.hero = new Character();
		loadLevel(Integer.parseInt(levelToLoad));
		
		this.gameListener = new CentipedeListener();
		this.addKeyListener(this.gameListener);
	}

	private void loadLevel(int levelNum) {
		// LOAD LEVEL FROM FILE
		if (levelNum == 99){
			// LOAD SAMPLE LEVEL
			System.out.println("LOADING SAMPLE LEVEL");
			for(int i=0; i<10; i++){
				this.mushrooms.add(new Mushroom(150 + 50*i, 450));
				this.mushrooms.add(new Mushroom(175 + 50*i, 425));
			}
		}
	}
	
	private void addSquare(Graphics2D g2, int x, int y, Color color){
		// ADD A SQUARE
		g2.setColor(color);
		g2.fill(new Rectangle2D.Double(x, y, BLOCK_SIZE, BLOCK_SIZE));
	}

	@Override
	public void run() {
		try{
			while (true){
				this.repaint();
				Thread.sleep(50);
			}
		}
		
		catch (InterruptedException ex){
			// Interrupted
		}

	}

//	private void redraw() {
//		// REDRAW SQUARES FROM POSITIONS
//		Graphics2D g2 = new Graphics();
//		Rectangle2D.Double square = new Rectangle2D.Double(x, y, BLOCK_SIZE, BLOCK_SIZE);
//		
//	}
	
	@Override
	protected void paintComponent(Graphics g){
		super.paintComponent(g);
		Graphics2D g2 = (Graphics2D) g;
		// LOOP THROUGH ITEMS, ENEMIES, AND CHARACTER AND DRAW THEM
		for(Mushroom m: mushrooms){
			Color mushroomColor = NORMAL_MUSHROOM_COLOR;
			if(m.getPoisonedStatus()){
				mushroomColor = POISONED_MUSHROOM_COLOR;
			}
			addSquare(g2, m.getX(), m.getY(), mushroomColor);
		}
		hero.move(this.gameListener.getHashMap());
		addSquare(g2, this.hero.getX(), this.hero.getY(), HERO_COLOR);
	}

}
